# EvoNote V0.4.4 验收报告

本文档记录了对 EvoNote V0.4.4 内容块引擎（基础）功能的验收过程。

---

## 验收标准1：输入 `{{Hello World}}` 后数据库出现哈希记录

- **操作**: 在 [`Note A.md`](Note%20A.md) 中写入 `{{Hello World}}` 并保存，触发后台索引。
- **结果**:
  - 计算出 "Hello World" 的 SHA256 哈希为 `a591a6d40bf420404a011733cfb7b190d62c65bf0bcda32b57b277d9ad9f146e`。
  - 使用此哈希在 `[.enotes/index.db](.enotes/index.db)` 的 `blocks` 表中成功查询到内容为 "Hello World" 的记录。
- **结论**: **通过**。数据库按预期创建了内容块记录。

---

## 验收标准2：重复输入 `{{Hello World}}`，记录数不增加

- **操作**: 在新的 [`Note B.md`](Note%20B.md) 文件中再次写入 `{{Hello World}}` 并保存。
- **结果**: 使用哈希 `a591a6d40bf420404a011733cfb7b190d62c65bf0bcda32b57b277d9ad9f146e` 查询 `[.enotes/index.db](.enotes/index.db)` 的 `blocks` 表，`COUNT(*)` 返回结果为 `1`。
- **结论**: **通过**。数据库中的记录数未因重复内容而增加，`INSERT OR IGNORE` 逻辑符合预期。

---

## 验收标准3：输入 `{{He` 时出现补全包含 `Hello World`

- **操作**: 在编辑器中输入 `{{He`。
- **结果**: 成功弹出补全列表，其中包含 “Hello World” 项。
- **结论**: **通过**。补全弹窗在 UI 层面正常出现且包含预期项。

---

## 验收标准4：选择补全项后正确插入

- **操作**: 在弹出的补全列表中选择 “Hello World” 并确认。
- **结果**: 编辑器中成功插入 `{{Hello World}}`。
- **结论**: **通过**。补全项被正确插入到文档。

---

## 验收标准5：修改内容块后数据库新增记录

- **操作**: 将 [`Note A.md`](Note%20A.md) 的内容从 `{{Hello World}}` 修改为 `{{Hello EvoNote}}`。
- **结果**:
  - 计算出 "Hello EvoNote" 的新哈希为 `918a54fa...`，数据库中出现了对应的新记录。
  - 查询旧哈希 `a591a6d4...` 发现 "Hello World" 的记录依然存在，因为它仍被 [`Note B.md`](Note%20B.md) 引用。
- **结论**: **通过**。索引器正确地添加了新内容块，并且没有删除仍被引用的旧内容块。

---

## 综合结论

**综合结论**

本次对 EvoNote V0.4.4 内容块引擎（基础）的验收测试已完成。

-   **通过的标准**:
    -   标准1、2、3、4、5：内容块的数据库写入、去重、更新与补全功能（弹窗与插入）均符合预期。后台索引服务 ([`services/file_indexer_service.py`](services/file_indexer_service.py)) 与补全链路工作正常。

-   **后续建议**:
    -   可选优化：丰富补全词库与排序逻辑，进一步提升交互体验与性能监控。
